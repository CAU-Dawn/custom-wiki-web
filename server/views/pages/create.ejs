<!DOCTYPE HTML>

<html>
<head>
    <title><%= title %></title>
    <% include ../partials/stylesheet %>
    <% include ../partials/ck %>
</head>
<body>
    <% include ../partials/nav %>
    <div class="container">
        <div class="page-header">
            <h1>Here to create.</h1>
        </div>
        <div class="create-editor">
            <button id="edit" class="btn btn-primary" onclick="edit()" type="button">Edit</button>
            <button id="submit" class="btn btn-primary" onclick="submit()" type="button">Submit</button>
            <div id="editor">
                <h2>input title please</h2>
            </div>
        </div>
        <div>
           <input type = "checkbox" id="checkBox" onClick="password()">비밀번호
           <div id="passwordBox" style="display:none">
               <h4 >Password:<input type ="password" id="password"></h4>
           </div>
       </div>
    </div>
    <script type="text/javascript">
    var edit = function(){
            BalloonEditor
               .create( document.querySelector( '#editor' ) )
               .then( editor => {
                    theEditor = editor;
               })
               .catch( error => {
                    console.error( error );
               });
                function getDataFromTheEditor() {
                   return theEditor.getData();
               };
    };
    var submit = function(){
        var contents = theEditor.getData();
        var title = $("#editor h2").text();
        console.log(contents);
        console.log(title);
        $.ajax({
            url: '/create',
            type: 'post',
            data: {"contents": contents, "title": title, "password": password},
            dataType: 'JSON',
            success: function(result)
            {
                console.log(result);
                if ( result.status == 1 ) {
                    location.replace("/show?id="+result.newtitle);
                } else {
                    alert('wiki title already exists.');
                    theEditor.destroy()
                        .catch( error => {
                            console.log( error);
                        });
                }
            }
         })
    };
    var password = function(){
       var checkBox = document.getElementById("checkBox")
       var password = document.getElementById("passwordBox")

       if(checkBox.checked == true){
           password.style.display = "block"
       } else
           password.style.display = "none"
       }
    </script>

    <% include ../partials/footer %>
    <% include ../partials/javascript %>

    <script>
       $('#password').on("input", function(){
               password = $(this).val();
           });
   </script>

</body>
</html>
